import{h as e,B as n,C as t,r as a,o as s,d as r,e as l,q as o,D as c,E as i,f as u}from"./vendor.b9b68d7e.js";let R,d=[0,0,0,0],b=[],p=[],f=0,h=!1;function k(){if(h)return;let e,n,t,a,s,r,l;switch(p[f]){case 10:f++,e=p[f++],n=p[f++],d[e]=d[n];break;case 11:f++,e=p[f++],t=p[f++],d[e]=t;break;case 20:f++,e=p[f++],n=p[f++],d[e]+=d[n];break;case 21:f++,e=p[f++],n=p[f++],d[e]-=d[n];break;case 30:f++,n=p[f++],b.push(d[n]);break;case 31:f++,e=p[f++],d[e]=b.pop();break;case 40:f++,a=p[f++],f=a;break;case 41:f++,s=p[f++],r=p[f++],a=p[f++],d[s]<d[r]&&(f=a);break;case 42:f++,a=p[f++],b.push(f),f=a;break;case 50:f++,a=b.pop(),f=a;break;case 60:f++,l=p[f++],m(d[l]);break;case 255:f++,h=!0;break;default:m("Error in bytecode, instr unknown:"),h=!0}f>=p.length&&(h=!0)}function m(e){console.log(e),R(e)}var V={init:function(e,n){p=e,f=0,h=!1,b=[],R=n},run:function(){for(;!h;)k()}};let C={MOVR:10,MOVV:11,ADD:20,SUB:21,PUSH:30,POP:31,JP:40,JL:41,CALL:42,RET:50,PRINT:60,HALT:255},v={R0:0,R1:1,R2:2,R3:3};var O={assemble:function(e){return function(e){let n=[];for(let t of e)for(let e=0;e<t.length;e++){let a=t[e].trim().toUpperCase();0==e?(a=C[a],n.push(a||-1)):(a.startsWith("R")&&(a=v[a]),n.push(parseInt(a)))}return n}(function(e){let n=e.split(/\r?\n/);for(let t=n.length-1;t>=0;t--){let e=n[t].trim();e&&!e.startsWith("//")?n[t]=e.split(/[\s,]+/):n.splice(t,1)}return n}(e))}};let P="// Loads value 10 in R0 \n// and calls Fibonacci routine\n\nMOVV R0, 10\nCALL 6\nHALT\n\n// This is the Fibonacci routing\n// Expects number of Fibonacci \n// numbers in register R0\n\nPUSH R0\nMOVV R0, 0\nMOVV R1, 1\nMOVV R3, 1\nPRINT R1\n\nMOVR R2, R0\nADD R2, R1\nPRINT R2\nMOVR R0, R1\nMOVR R1, R2\nMOVV R2, 1\nADD R3, R2\nPOP R2\nPUSH R2\nJL R3, R2, 19\nPOP R0\nRET\n",M="";function A(e){return O.assemble(e).toString()}function L(e){let n=function(e){let n=e.split(",");for(let t=0;t<n.length;t++)n[t]=parseInt(n[t]);return n}(e);return M="",V.init(n,(e=>M+=e+"\n")),V.run(),M}L(A(P));const g={name:"VirtualMachine",setup(){let n=e(""),t=e("");return{code:P,onAssembleClick:function(){n.value=A(P)},onRunClick:function(){t.value=L(n.value)},machineCode:n,result:t}}},x=i();n("data-v-bd47c32a");const T={class:"virtual-machine"},U={class:"source-code"},D=l("h3",null,"Instructions",-1),I={class:"machine-code"},E=l("h3",null,"machine code",-1),H=u("assemble"),S={class:"result"},y=l("h3",null,"instruction result",-1),_=u("run");t();const F=x(((e,n,t,i,u,R)=>{const d=a("klk-button");return s(),r("div",T,[l("div",U,[D,o(l("textarea",{"onUpdate:modelValue":n[1]||(n[1]=e=>i.code=e),type:"text"},"\n        ",512),[[c,i.code]])]),l("div",I,[E,o(l("textarea",{"onUpdate:modelValue":n[2]||(n[2]=e=>i.machineCode=e),type:"text"},"\n        ",512),[[c,i.machineCode]]),l(d,{onClick:i.onAssembleClick},{default:x((()=>[H])),_:1},8,["onClick"])]),l("div",S,[y,o(l("textarea",{"onUpdate:modelValue":n[3]||(n[3]=e=>i.result=e),type:"text"},"\n        ",512),[[c,i.result]]),l(d,{onClick:i.onRunClick},{default:x((()=>[_])),_:1},8,["onClick"])])])}));g.render=F,g.__scopeId="data-v-bd47c32a";export default g;
